## AB测试完整过程及计算示例

---
假设你正在运营一个移动应用，想要通过AB测试验证一个新功能（B版本）是否能提升用户的**注册转化率**（例如，用户完成注册的比例）。你已经有了对照组A（当前版本）和实验组B（新功能版本），下面是AB测试的完整流程，包括如何计算所需的样本量、进行实验以及数据分析。

### **步骤一：定义目标与假设**

**目标**：测试B版本的新功能是否能提高用户注册转化率。

**假设**：
- **H0（零假设）**：B版本与A版本的注册转化率没有显著差异（B版本没有效果）。
- **H1（备择假设）**：B版本的注册转化率高于A版本（B版本有效）。

### **步骤二：设计实验**

1. **实验组与对照组分配**：
   - 将用户随机分配到两个组，**A组**（对照组）使用现有的注册流程，**B组**（实验组）使用新增的注册功能。
   - 实验时间：假设你计划进行7天的实验。
   - 样本量：根据你预期的效果和目标来计算每组所需的样本量。

2. **计算样本量**：
   假设你希望检测到至少1%的转化率差异，且置信度为95%（Z值为1.96），统计功效为80%（Z值为0.84），当前A组的转化率（P）是10%，你预期B组的转化率（P_b）为11%。

   **计算公式**：
   
$$
n = \frac{Z_{\alpha/2}^2 \cdot (P(1 - P) + P_b(1 - P_b))}{(P - P_b)^2}
$$
   
   代入数值：
   - **$Z_{\alpha/2}$ = 1.96**（对应95%置信度）
   - **$P$ = 0.10**（A组转化率）
   - **$P_b = 0.11$**（B组预期转化率）
   - **$P - P_b$ = 0.01**（预期差异）

   计算：
$$
n = \frac{1.96^2 \cdot (0.10(1 - 0.10) + 0.11(1 - 0.11))}{(0.10 - 0.11)^2}
$$

$$
n = \frac{3.8416 \cdot (0.10 \times 0.90 + 0.11 \times 0.89)}{0.01^2}
$$

$$
n = \frac{3.8416 \cdot (0.09 + 0.0979)}{0.0001}
$$

$$
n = \frac{3.8416 \cdot 0.1879}{0.0001}
$$

$$
n = 7222
$$
   
   所以，**每组所需的样本量为7222**。

### **步骤三：实施AB测试**

1. **分配用户**：将用户随机分配到A组和B组，每组大约有7222个用户。
2. **监测指标**：监控并记录每个用户的行为，特别是他们是否完成了注册（即转化）。

### **步骤四：数据收集与计算**

假设7天后，你收集到以下数据：
- **A组**：7222个用户中，有720个用户完成注册，转化率为 $\frac{720}{7222} = 10\%$
- **B组**：7222个用户中，有792个用户完成注册，转化率为 $\frac{792}{7222} = 10.96\%$

### **步骤五：数据分析**

1. **统计分析**：使用 **t检验** 或 **卡方检验** 来判断两组之间的转化率差异是否具有统计显著性。

假设使用 **Z检验**，计算两组的**转化率差异**：

$$
\Delta P = P_b - P = 0.1096 - 0.10 = 0.0096
$$

接着计算标准误差（SE）：

$$
SE = \sqrt{\frac{P(1 - P)}{n_A} + \frac{P_b(1 - P_b)}{n_B}} = \sqrt{\frac{0.10(1 - 0.10)}{7222} + \frac{0.1096(1 - 0.1096)}{7222}} 
$$

$$
SE = \sqrt{\frac{0.09}{7222} + \frac{0.0978}{7222}} = \sqrt{0.0000125 + 0.0000135} = \sqrt{0.000026} = 0.0051
$$

计算 **Z值**：

$$
Z = \frac{\Delta P}{SE} = \frac{0.0096}{0.0051} = 1.88
$$

根据 **Z值**，查找 **Z分布表**，对应的 **p值** 为 0.03（假设单侧检验）。

2. **判断是否显著**：
   - 置信度为95%，意味着**α = 0.05**。如果 **p值 < 0.05**，则认为结果具有统计显著性。
   - 由于 **p值 = 0.03** < **0.05**，我们拒绝零假设 **H0**，认为B版本的新功能显著提高了转化率。

### **步骤六：得出结论**

**结论**：
- B版本（新功能）显著提升了用户的注册转化率。
- 根据AB测试结果，你可以决定将新功能推广到全体用户。

---

### **总结**
AB测试通过比较实验组和对照组在某一关键指标（如转化率、留存率等）上的表现差异，帮助你评估某个新功能或变化是否有效。在这个例子中，我们从设计实验、计算样本量，到进行数据收集与统计分析，最终得出了新功能有效的结论。

AB测试的关键点：
- **样本量的计算**：确保测试结果的可靠性和统计显著性。
- **数据分析**：通过统计方法验证假设，确保结论的有效性。
